<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <title>Release notes</title>

    <link rel="stylesheet" href="./formatting.css">
    
</head>
<body class="rustdoc">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    <nav class="sidebar">
  <h2 class="location">
    <a href="#">Dynasm-rs reference</a>
  </h2>
  <div class="sidebar-elems">
    <h3>Components</h3>
    <ul class="block crate">
      <li>
        <a href="../language/index.html">Syntax</a>
      </li>
      <li>
        <a href="../dynasm/index.html">Plugin (dynasm)</a>
      </li>
      <li>
        <a href="../dynasmrt/index.html">Runtime (dynasmrt)</a>
      </li>
    </ul>
    <h3>Syntax</h3>
    <ul class="block crate">
      <li>
        <a href="./index.html">Home</a>
      </li>
      <li>
        <a href="./tutorial.html">Tutorial</a>
      </li>
      <li>
        <a href="./langref_common.html">Language</a>
      </li>
      <li>
        <a href="./releasenotes.html">Release Notes</a>
      </li>
    </ul>
    <h3>Architectures</h3>
    <h4>x64/x86</h4>
    <ul class="block crate">
      <li>
        <a href="./langref_x64.html">Language dialect</a>
      </li>
      <li>
        <a href="./instructionref_x64.html">Instruction reference</a>
      </li>
    </ul>
    <h4>aarch64</h4>
    <ul class="block crate">
      <li>
        <a href="./langref_aarch64.html">Language dialect</a>
      </li>
      <li>
        <a href="./instructionref_aarch64.html">Instruction reference</a>
      </li>
    </ul>
    <h4>riscv32/riscv64</h4>
    <ul class="block crate">
      <li>
        <a href="./langref_riscv.html">Language dialect</a>
      </li>
      <li>
        <a href="./instructionref_riscv.html">Instruction reference</a>
      </li>
    </ul>
  </div>
</nav>
<section id="main" class="content mod docblock">

    <h1 class="title">Release notes</h1>
    <p>The <code>dynasm-rs</code> project consists out of two crates: The procedural macro crate <code>dynasm</code> and the runtime support crate <code>dynasmrt</code>. The versions of these two crates are synchronized and should always match. From version 0.7.0 onwards <code>dynasmrt</code> depends on <code>dynasm</code> itself to simplify this relationship. Any version listings below therefore refers to both the <code>dynasm</code> and <code>dynasmrt</code> crate version.</p>
<h1 id="version-321"><a class="doc-anchor" href="#version-321">§</a>Version 3.2.1</h1><h2 id="runtime"><a class="doc-anchor" href="#runtime">§</a>Runtime</h2>
<ul>
<li>Cache invalidation on aarch64 Apple hardware now does not crash with an illegal instruction exception.</li>
</ul>
<h1 id="version-320"><a class="doc-anchor" href="#version-320">§</a>Version 3.2.0</h1><h2 id="architecture-support"><a class="doc-anchor" href="#architecture-support">§</a>Architecture support</h2>
<ul>
<li>RISC-V targets got support for the <code>Zfinx</code>, <code>Zhinx</code>, <code>Zdinx</code>, <code>Zhinxmin</code> and <code>Zfhmin</code> instruction
set extensions.</li>
<li>RISC-V targets now automatically expand the <code>B</code> collection of ISA EXTENSIONS</li>
<li>RISC-V targets now ignore the <code>Ztso</code> extension instead of it causing an error
(as it doesn’t actually add any new instructions).</li>
</ul>
<h1 id="version-310"><a class="doc-anchor" href="#version-310">§</a>Version 3.1.0</h1><h2 id="summary"><a class="doc-anchor" href="#summary">§</a>Summary</h2>
<p>This release adds support for several architectures from the RISC-V family of instruction sets.
These are <code>riscv64i</code>, <code>riscv64e</code>, <code>riscv32i</code> and <code>riscv32e</code>. There’s also support for a large set
of instruction set extensions. This architecture support is introduced with the same standards as
currently supported targets, meaning that they come with full runtime support, immediate checking
and cache management support out of the box.</p>
<p>This architecture support has been sponsored by <a href="https://wasmer.io">Wasmer</a>.</p>
<h2 id="general"><a class="doc-anchor" href="#general">§</a>General</h2>
<ul>
<li>dependencies have been updated</li>
<li>handled many clippy warnings (Thanks to waywardmonkeys!)</li>
</ul>
<h2 id="architecture-support-1"><a class="doc-anchor" href="#architecture-support-1">§</a>Architecture support</h2>
<ul>
<li>added <code>riscv32i</code>, <code>riscv32e</code>, <code>riscv64i</code> and <code>riscv64e</code> architecture targets.</li>
<li><code>x64</code> gained support for the <code>RDPRU</code> instruction (Thanks to eigenform!).</li>
</ul>
<h1 id="version-301"><a class="doc-anchor" href="#version-301">§</a>Version 3.0.1</h1><h2 id="bugfix"><a class="doc-anchor" href="#bugfix">§</a>Bugfix</h2>
<ul>
<li><code>x64</code> immediate const evaluation now handles negative displacements properly again, generating
8-bit displacements where possible.</li>
</ul>
<h1 id="version-300"><a class="doc-anchor" href="#version-300">§</a>Version 3.0.0</h1><h2 id="summary-1"><a class="doc-anchor" href="#summary-1">§</a>Summary</h2>
<p>This release brings significant improvements to the <code>aarch64</code> experience. The runtime assemblers now
handle cache invalidation internally where necessary. Furthermore, where previously overly large
immediates would just wrap during encoding, they are now fully checked and error at compile time, or
panic at runtime. One major backwards compatibility break is that the syntax for data directives has
changed. This syntax now uses the relevant rust type names, and supports significantly more types.
Next to this, several long-standing bugs have been fixed, dependencies have been updated, and the
crate has moved to rust edition 2021. The minimum supported rust version is now <code>1.77</code>.</p>
<h2 id="general-1"><a class="doc-anchor" href="#general-1">§</a>General</h2>
<ul>
<li>Moved to rust edition 2021</li>
<li>Dependencies have been updated.</li>
<li>minimum supported rust version increased to <code>1.77</code> to allow for the use of <code>mem::offset_of!</code>.</li>
<li>data directives now use <code>.u8</code>, <code>.i16</code>, <code>.f32</code> syntax.</li>
<li>Several documentation improvements have been made.</li>
<li>More tests have been introduced.</li>
</ul>
<h2 id="architecture-support-2"><a class="doc-anchor" href="#architecture-support-2">§</a>Architecture support</h2>
<ul>
<li><code>x64</code> gained support for the <code>MOVDIRI</code> instruction</li>
<li><code>x64</code> gained support for the <code>ZWORD</code> operand size (needed for AVX512 support in the future)</li>
<li>the <code>aarch64</code> assemblers now handle cache control internally. It is no longer needed for the user to handle this.</li>
<li>Immediates in <code>aarch64</code> assembly are now fully size checked, where possible at compile time. Attempting to assemble an impossible immediate at runtime will cause a panic.</li>
</ul>
<h2 id="bugfixes"><a class="doc-anchor" href="#bugfixes">§</a>Bugfixes</h2>
<ul>
<li>All documentation/example crates now compile on stable rustc.</li>
<li>Worked around a <a href="https://github.com/rust-lang/rust/issues/67062">rustc compiler bug</a> that was causing operator precedence issues in emitted code.</li>
<li>Fixed x64/x86 register names used in compiler error debug messages.</li>
<li>Renamed several documentation bin targets due to artefact name collision errors in the workspace.</li>
<li>Fix unneeded parenthesis warnings in emitted code.</li>
<li>Eliminated warnings during plugin build.</li>
<li>the aarch64 instruction <code>mov w0, immu32</code> now expects a <code>u32</code> as immediate instead of an <code>u64</code>.</li>
</ul>
<p>Several of these changes were the result of external contributions, we’d like to thank everyone who contributed to this release.</p>
<h1 id="version-200"><a class="doc-anchor" href="#version-200">§</a>Version 2.0.0</h1><h2 id="plugin"><a class="doc-anchor" href="#plugin">§</a>Plugin</h2>
<ul>
<li>Be stricter on X/W or XSP/WSP differentiation in x64.</li>
</ul>
<h2 id="runtime-1"><a class="doc-anchor" href="#runtime-1">§</a>Runtime</h2>
<ul>
<li>Significant performance optimization of label processing.</li>
<li>Rework of various components.</li>
<li>Additional APIs to reuse Assemblers, or to allocate them with pre-reserved buffers.</li>
</ul>
<h2 id="documentation"><a class="doc-anchor" href="#documentation">§</a>Documentation</h2>
<ul>
<li>Various fixes</li>
</ul>
<h1 id="version-123"><a class="doc-anchor" href="#version-123">§</a>Version 1.2.3</h1><h2 id="plugin-1"><a class="doc-anchor" href="#plugin-1">§</a>Plugin</h2>
<ul>
<li>add x64 ud1 opcode.</li>
<li>Bugfix the REPNE prefix so it can actually be used.</li>
</ul>
<h1 id="version-122"><a class="doc-anchor" href="#version-122">§</a>Version 1.2.2</h1><h2 id="global"><a class="doc-anchor" href="#global">§</a>Global</h2>
<p>Fixes travis integration displayed in crates.io</p>
<h1 id="version-121"><a class="doc-anchor" href="#version-121">§</a>Version 1.2.1</h1><h2 id="runtime-2"><a class="doc-anchor" href="#runtime-2">§</a>Runtime</h2>
<ul>
<li>Fix overflow in aarch64 logical immediate encoding at runtime.</li>
</ul>
<h1 id="version-120"><a class="doc-anchor" href="#version-120">§</a>Version 1.2.0</h1><h2 id="runtime-3"><a class="doc-anchor" href="#runtime-3">§</a>Runtime</h2>
<ul>
<li>update memmap2 version.</li>
</ul>
<h1 id="version-110"><a class="doc-anchor" href="#version-110">§</a>Version 1.1.0</h1><h2 id="runtime-4"><a class="doc-anchor" href="#runtime-4">§</a>Runtime</h2>
<ul>
<li>Added missing label management methods to <code>VecAssembler</code>.</li>
</ul>
<h1 id="version-101"><a class="doc-anchor" href="#version-101">§</a>Version 1.0.1</h1><h2 id="runtime-5"><a class="doc-anchor" href="#runtime-5">§</a>Runtime</h2>
<ul>
<li>Switched from the unmaintained <code>memmap</code> crate to <code>memmap2</code>.</li>
</ul>
<h1 id="version-100"><a class="doc-anchor" href="#version-100">§</a>Version 1.0.0</h1><h2 id="global-1"><a class="doc-anchor" href="#global-1">§</a>Global</h2>
<ul>
<li>First release on rust stable (1.45+)!</li>
</ul>
<h2 id="plugin-2"><a class="doc-anchor" href="#plugin-2">§</a>Plugin</h2>
<ul>
<li>Use new Span::mixed_site hygiene to replace call_site hygiene wherever relevant.</li>
</ul>
<h1 id="version-071"><a class="doc-anchor" href="#version-071">§</a>Version 0.7.1</h1><h2 id="runtime-6"><a class="doc-anchor" href="#runtime-6">§</a>Runtime</h2>
<ul>
<li>Fixed an issue where calls to Modifier.extend would cause invalid code to be emitted.</li>
</ul>
<h1 id="version-070"><a class="doc-anchor" href="#version-070">§</a>Version 0.7.0</h1><h2 id="global-2"><a class="doc-anchor" href="#global-2">§</a>Global</h2>
<ul>
<li>Updated everything to the 2018 edition of rust.</li>
<li>The crate will be able to be used on a rust 1.45 stable compiler!</li>
</ul>
<h2 id="plugin-3"><a class="doc-anchor" href="#plugin-3">§</a>Plugin</h2>
<ul>
<li>File-local directives now requires the <code>filelocal</code> feature and a nightly compiler.</li>
<li>Now compiles and is usable on a stable 1.45 rust compiler.</li>
<li>Added <code>dynasm_backwards!</code>, which emits templates in reverse order. This allows writing assemblers that compile code backwards.</li>
</ul>
<h2 id="runtime-7"><a class="doc-anchor" href="#runtime-7">§</a>Runtime</h2>
<ul>
<li><code>dynasmrt</code> now re-exports the <code>dynasm!</code> macro from <code>dynasm</code>, so projects only need the <code>dynasmrt</code> dependency.</li>
<li>Refactoring PatchLoc and Relocation to generalize relocation handling between architectures.</li>
<li>Added register family listings, to facilitate dynamic register usage. This feature was contributed by vext01.</li>
</ul>
<h1 id="version-060"><a class="doc-anchor" href="#version-060">§</a>Version 0.6.0</h1><h2 id="runtime-8"><a class="doc-anchor" href="#runtime-8">§</a>Runtime</h2>
<ul>
<li>Significant internal refactoring: Architectural support is now abstracted through the Relocation trait, that all assemblers are generic over. Aliases for the previous architecture-specific assemblers are kept for backwards compatibility.</li>
<li>Made assembler components public to facilitate writing custom assemblers.</li>
</ul>
<h2 id="tests"><a class="doc-anchor" href="#tests">§</a>Tests</h2>
<ul>
<li>Reduced compile time significantly by migrating simple instruction format tests to <code>SimpleAssembler</code>.</li>
</ul>
<h1 id="version-052"><a class="doc-anchor" href="#version-052">§</a>Version 0.5.2</h1><h2 id="plugin-4"><a class="doc-anchor" href="#plugin-4">§</a>Plugin</h2>
<ul>
<li>Remove a problematic semicolon that might cause errors in the future.</li>
<li>README update.</li>
</ul>
<h1 id="version-051"><a class="doc-anchor" href="#version-051">§</a>Version 0.5.1</h1><h2 id="runtime-9"><a class="doc-anchor" href="#runtime-9">§</a>Runtime</h2>
<ul>
<li>Fix a bug that caused emitted code corruption corruption in Aarch64’s B and ADRP relocation calculations.</li>
</ul>
<h1 id="version-050"><a class="doc-anchor" href="#version-050">§</a>Version 0.5.0</h1><h2 id="plugin-5"><a class="doc-anchor" href="#plugin-5">§</a>Plugin</h2>
<ul>
<li>We now support an arbitrary offset added to any jump. This feature allows direct addressing of literal pools or arrays of values without generating labels for every single item in them.</li>
</ul>
<h2 id="runtime-10"><a class="doc-anchor" href="#runtime-10">§</a>Runtime</h2>
<ul>
<li>Added LitPool, a tool to automatically build literal pools.</li>
<li>Impossible relocations no longer panic. Instead they cause an error to be emitted from <code>Assembler::commit()</code>.</li>
<li>Significant refactoring.</li>
</ul>
<h1 id="version-040"><a class="doc-anchor" href="#version-040">§</a>Version 0.4.0</h1><h2 id="architecture-support-3"><a class="doc-anchor" href="#architecture-support-3">§</a>Architecture support</h2>
<ul>
<li>Added Aarch64 support, thanks to sponsoring from <a href="https://wasmer.io">Wasmer</a>.</li>
</ul>
<h2 id="plugin-6"><a class="doc-anchor" href="#plugin-6">§</a>Plugin</h2>
<ul>
<li>Remove use of mem::unitialized when calculating the offsets of members in structs in generated code.
-Optimization of opmap and register tables to reduce compile time and file size.</li>
</ul>
<h2 id="documentation-1"><a class="doc-anchor" href="#documentation-1">§</a>Documentation</h2>
<ul>
<li>Split architecture-specific DSL documentation and generic DSL documentation.</li>
<li>Ported examples to Aarch64.</li>
</ul>
<h1 id="version-032"><a class="doc-anchor" href="#version-032">§</a>Version 0.3.2</h1><h2 id="plugin-7"><a class="doc-anchor" href="#plugin-7">§</a>Plugin</h2>
<ul>
<li>x64/x86: Always escape into SIB encoding with a displacement when a register is used as a memory reference base, to allow RBP to be encoded.</li>
<li>x64/x86: Properly handle dynamic registers in VEX prefixes</li>
</ul>
<h1 id="version-031"><a class="doc-anchor" href="#version-031">§</a>Version 0.3.1</h1><h2 id="plugin-8"><a class="doc-anchor" href="#plugin-8">§</a>Plugin</h2>
<ul>
<li>Fixed an issue where dynamic registers caused wrong code generation.</li>
</ul>
<h2 id="runtime-11"><a class="doc-anchor" href="#runtime-11">§</a>Runtime</h2>
<ul>
<li>Added an API for returning the offset of a dynamic label directly.</li>
</ul>
<h1 id="version-030"><a class="doc-anchor" href="#version-030">§</a>Version 0.3.0</h1><h2 id="architecture-support-4"><a class="doc-anchor" href="#architecture-support-4">§</a>Architecture support</h2>
<ul>
<li>Fixed SETB and SETNB not being present in x64/x86</li>
</ul>
<h2 id="plugin-9"><a class="doc-anchor" href="#plugin-9">§</a>Plugin</h2>
<ul>
<li>The plugin has been updated to the new procedural macro system. This means it should no longer break when new compiler versions are released.</li>
<li>Directives are now scoped file-local instead of crate-local.</li>
</ul>
<h2 id="runtime-12"><a class="doc-anchor" href="#runtime-12">§</a>Runtime</h2>
<ul>
<li>The alter API can now return values produced by the user-defined closure.</li>
</ul>
<h1 id="versions-021-022-and-023"><a class="doc-anchor" href="#versions-021-022-and-023">§</a>Versions 0.2.1, 0.2.2 and 0.2.3</h1><h2 id="plugin-10"><a class="doc-anchor" href="#plugin-10">§</a>Plugin</h2>
<ul>
<li>Updates so it stays compatible with rustc as the plugin API changes.</li>
</ul>
<h1 id="version-020"><a class="doc-anchor" href="#version-020">§</a>Version 0.2.0</h1><h2 id="architecture-support-5"><a class="doc-anchor" href="#architecture-support-5">§</a>Architecture support</h2>
<ul>
<li>Added support for x86</li>
<li>Enabled relocation support in x64 when additional immediate fields are present.</li>
</ul>
<h2 id="plugin-11"><a class="doc-anchor" href="#plugin-11">§</a>Plugin</h2>
<ul>
<li>Significant refactoring of the x64 backend to also handle x86</li>
<li>Added x64 feature selection support.</li>
</ul>
<h2 id="runtime-13"><a class="doc-anchor" href="#runtime-13">§</a>Runtime</h2>
<ul>
<li>Added managed relocation support to handle non-relative relocations.</li>
</ul>
<h1 id="versions-014-013-012-011"><a class="doc-anchor" href="#versions-014-013-012-011">§</a>Versions 0.1.4, 0.1.3, 0.1.2, 0.1.1</h1><h2 id="plugin-12"><a class="doc-anchor" href="#plugin-12">§</a>Plugin</h2>
<ul>
<li>Updates so it stays compatible with rustc as the plugin API changes.</li>
</ul>
<h1 id="versions--010"><a class="doc-anchor" href="#versions--010">§</a>Versions &lt;= 0.1.0</h1><h2 id="global-3"><a class="doc-anchor" href="#global-3">§</a>Global</h2>
<ul>
<li>Initial library experiments, starting with basic x64 support, refactoring to support multiple architectures, and cleanup.</li>
</ul>

    </section>
<script type="text/javascript">
// make diffs look better, I can't do this in css for some reason and I don't want to hack it into rustdocs

document.addEventListener("DOMContentLoaded", function() {

    var old = document.querySelectorAll("code.language-diffold");
    var old_pre = [];
    for (var i = 0; i < old.length; i++) {
        var old_pre = old[i].parentNode;
        var new_pre = old_pre.nextElementSibling;
        if (new_pre && new_pre.childNodes.length > 0 && new_pre.childNodes[0].className == "language-diffnew") {
            old_pre.className = "collapse-old";
            new_pre.className = "collapse-new";
        }
    }

});
</script>

</body>
</html>